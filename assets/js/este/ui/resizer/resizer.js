// Coffe Class fixed for Closure Compiler by Este.js
// Generated by CoffeeScript 1.4.0
/**
	@fileoverview
	@see ../demos/resizer.html
*/



goog.provide('este.ui.Resizer');

goog.require('goog.ui.Component');

goog.require('este.events.Delegation.create');

goog.require('este.ui.resizer.Handles.create');



  

  /**
  		@param {Function}	delegationFactory
  		@param {Function}	handlesFactory
  		@constructor
  		@extends {goog.ui.Component}
  */


  este.ui.Resizer = function(delegationFactory, handlesFactory) {
    this.delegationFactory = delegationFactory;
    this.handlesFactory = handlesFactory;
    este.ui.Resizer.superClass_.constructor.call(this);
  }

  goog.inherits(este.ui.Resizer, goog.ui.Component);

  /**
  		@return {este.ui.Resizer}
  */


  este.ui.Resizer.create = function() {
    return new este.ui.Resizer(este.events.Delegation.create, este.ui.resizer.Handles.create);
  };

  /**
  		@enum {string}
  */


  este.ui.Resizer.EventType = {
    RESIZEEND: 'resizeend'
  };

  /**
  		@type {Function}
  		@protected
  */


  este.ui.Resizer.prototype.delegationFactory = null;

  /**
  		@type {Function}
  		@protected
  */


  este.ui.Resizer.prototype.handlesFactory = null;

  /**
  		@type {number}
  */


  este.ui.Resizer.prototype.minimalWidth = 5;

  /**
  		@type {number}
  */


  este.ui.Resizer.prototype.minimalHeight = 5;

  /**
  		@type {Element}
  		@protected
  */


  este.ui.Resizer.prototype.activeElement = null;

  /**
  		@type {goog.math.Size}
  		@protected
  */


  este.ui.Resizer.prototype.activeElementSize = null;

  /**
  		@param {Element} element
  		@return {boolean}
  */


  este.ui.Resizer.prototype.targetFilter = function(element) {
    return true;
  };

  /**
  		@param {Element} element
  		@return {boolean}
  */


  este.ui.Resizer.prototype.targetParentFilter = function(element) {
    return true;
  };

  /**
  		@type {este.events.Delegation}
  		@protected
  */


  este.ui.Resizer.prototype.delegation = null;

  /**
  		@type {este.ui.resizer.Handles}
  		@protected
  */


  este.ui.Resizer.prototype.handles = null;

  /**
  		@type {boolean}
  		@protected
  */


  este.ui.Resizer.prototype.dragging = false;

  /**
  		@inheritDoc
  */


  este.ui.Resizer.prototype.enterDocument = function() {
    var events;
    este.ui.Resizer.superClass_.enterDocument.call(this);
    events = ['mouseover', 'mouseout'];
    this.delegation = this.delegationFactory(this.getElement(), events, this.targetFilter, this.targetParentFilter);
    this.getHandler().listen(this.delegation, 'mouseover', this.onDelegationMouseOver).listen(this.delegation, 'mouseout', this.onDelegationMouseOut);
  };

  /**
  		@inheritDoc
  */


  este.ui.Resizer.prototype.exitDocument = function() {
    este.ui.Resizer.superClass_.exitDocument.call(this);
    this.delegation.dispose();
    if (this.handles) {
      this.handles.dispose();
    }
  };

  /**
  		@param {goog.events.BrowserEvent} e
  		@protected
  */


  este.ui.Resizer.prototype.onDelegationMouseOver = function(e) {
    if (this.dragging) {
      return;
    }
    if (this.handles) {
      this.handles.dispose();
    }
    this.handles = this.handlesFactory();
    this.handles.decorate(e.target);
    return this.getHandler().listen(this.handles, 'mouseout', this.onDelegationMouseOut).listen(this.handles, 'start', this.onDragStart).listen(this.handles, 'drag', this.onDrag).listen(this.handles, 'end', this.onDragEnd);
  };

  /**
  		@param {goog.events.BrowserEvent} e
  		@protected
  */


  este.ui.Resizer.prototype.onDelegationMouseOut = function(e) {
    if (this.dragging || this.handles.isHandle(e.relatedTarget)) {
      return;
    }
    return this.handles.dispose();
  };

  /**
  		@param {goog.events.BrowserEvent} e
  		@protected
  */


  este.ui.Resizer.prototype.onDragStart = function(e) {
    var el = /** @type {Element} */ (e.element);
    this.activeElementSize = goog.style.getContentBoxSize(el);
    return this.dragging = true;
  };

  /**
  		@param {Object} e
  		@protected
  */


  este.ui.Resizer.prototype.onDrag = function(e) {
    var height, width;
    width = Math.max(this.minimalWidth, this.activeElementSize.width + e.width);
    height = Math.max(this.minimalHeight, this.activeElementSize.height + e.height);
    if (e.element.tagName !== 'IMG') {
      e.element.style.width = width + 'px';
      e.element.style.height = height + 'px';
      return;
    }
    if (e.vertical) {
      e.element.style.width = width + 'px';
      return e.element.style.height = 'auto';
    } else {
      e.element.style.width = 'auto';
      return e.element.style.height = height + 'px';
    }
  };

  /**
  		@param {Object} e
  		@protected
  */


  este.ui.Resizer.prototype.onDragEnd = function(e) {
    this.dragging = false;
    if (e.close) {
      this.handles.dispose();
    }
    return this.dispatchEvent({
      type: este.ui.Resizer.EventType.RESIZEEND,
      element: e.element
    });
  };

  
