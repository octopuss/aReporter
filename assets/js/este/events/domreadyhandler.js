// Coffe Class fixed for Closure Compiler by Este.js
// Generated by CoffeeScript 1.4.0
/**
  @fileoverview DomReady ported from jQuery. IE workaround does not work in
  frame so there is no need to inject document. Ready event is fired once.
  .. listen este.events.domReady, efn47v2hm63h1efn47v2hm63h, (e) ->
  Manually tested.
*/



goog.provide('este.events.domReady');

goog.provide('este.events.DomReadyHandler');

goog.require('goog.events.EventHandler');

goog.require('goog.events.EventTarget');



  

  /**
    @constructor
    @extends {goog.events.EventTarget}
  */


  este.events.DomReadyHandler = function() {
    var _this = this;
    este.events.DomReadyHandler.superClass_.constructor.call(this);
    if (document.readyState === 'complete') {
      setTimeout(function() {
        return _this.dispatchReadyEvent();
      }, 1);
    } else {
      this.handler = new goog.events.EventHandler(this);
      this.registerEvents();
    }
    return;
  }

  goog.inherits(este.events.DomReadyHandler, goog.events.EventTarget);

  /**
    @enum {string}
  */


  este.events.DomReadyHandler.EventType = {
    READY: 'ready'
  };

  /**
    @type {goog.events.EventHandler}
  */


  este.events.DomReadyHandler.prototype.handler = null;

  /**
    @protected
  */


  este.events.DomReadyHandler.prototype.registerEvents = function() {
    if (document.addEventListener) {
      this.handler.listen(document, 'DOMContentLoaded', this.onReady);
    } else {
      this.handler.listen(document, 'readystatechange', this.onReadyStateChange);
      if (this.canDoScrollCheck()) {
        this.doScrollCheck();
      }
    }
    return this.handler.listen(window, 'load', this.onReady);
  };

  /**
    @return {boolean}
    @protected
  */


  este.events.DomReadyHandler.prototype.canDoScrollCheck = function() {
    var topLevel;
    topLevel = false;
    try {
      topLevel = window.frameElement === null;
    } catch (e) {

    }
    return topLevel && !!document.documentElement.doScroll;
  };

  /**
    @param {goog.events.BrowserEvent} e
    @protected
  */


  este.events.DomReadyHandler.prototype.onReady = function(e) {
    return this.dispatchReadyEvent();
  };

  /**
    @param {goog.events.BrowserEvent} e
    @protected
  */


  este.events.DomReadyHandler.prototype.onReadyStateChange = function(e) {
    if (document.readyState !== 'complete') {
      return;
    }
    return this.dispatchReadyEvent();
  };

  /**
    @protected
  */


  este.events.DomReadyHandler.prototype.doScrollCheck = function() {
    var _this = this;
    try {
      document.documentElement.doScroll('left');
    } catch (e) {
      setTimeout(function() {
        return _this.doScrollCheck();
      }, 1);
      return;
    }
    return this.dispatchReadyEvent();
  };

  /**
    @protected
  */


  este.events.DomReadyHandler.prototype.dispatchReadyEvent = function() {
    var _ref;
    this.dispatchEvent('ready');
    return (_ref = this.handler) != null ? _ref.dispose() : void 0;
  };

  /**
    @override
  */


  este.events.DomReadyHandler.prototype.disposeInternal = function() {
    var _ref;
    este.events.DomReadyHandler.superClass_.disposeInternal.call(this);
    if ((_ref = this.handler) != null) {
      _ref.dispose();
    }
  };

  

este.events.domReady = new este.events.DomReadyHandler;
